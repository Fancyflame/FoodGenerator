<!DOCTYPE HTML>
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
    <title>untitled</title>
  </head>
  <body>
    <noscript>
      <mark color="red">此浏览器不支持JavaScript，请使用其它浏览器！</mark>
    </noscript>
    <textarea id="t"></textarea>
    <input type="button" id="b" value="生成" onclick="spawn()">
    <style>
      html,body{
        height:100%;
        margin:0;
      }
      #t{
        height:80%;
        width:100%;
        font-size:50px;
        border:5px solid black;
      }
      #b{
        height:8%;
        width:100%;
        font-size:50px;
      }
    </style>
    <script>
      var spawnTimes=0;
      var lastlth;
      function spawn(isalert){
        spawnTimes++;
        if(spawnTimes==15){
          alert("您已经是随机食物的铁杆粉了，为什么不"+
          "坐下来，放松一下心情，来一碗"+spawn(true)+"呢？");
        }else if(spawnTimes==25){
          alert("菜谱都要给您翻到底了，我们诚心推荐您试试"+
          spawn(true)+"，真的营养又健康");
        }else if(spawnTimes>=30&&spawnTimes%10==0){
          let u=confirm("看来我们大酒楼还是无法满足老板您的欲望，"+
            "您可以试试"+spawn(true)+"，我敢保证这一定能满足您");
          if(u)alert("吃个屁");
        }
        lastlth=null;
        try{
        function rnd(obj){
          return obj[Math.floor(Math.random()*obj.length)]
        }
        var t=document.getElementById("t");
        var p="";
        for(var i in arr_){
          var item=arr_[i];
          var grm=/\?/.test(item);
          item=item.replace("?","");
          var range;
          if(grm&&lastlth){
            function rg(num){
              let m=objl[arr_[i]][num];
              return m?m:[]
            }
            let a=rg(lastlth-2).concat(rg(lastlth-1),rg(lastlth));
            range=a;
          }else{
            let a=[];
            let b=objl[arr_[i]]
            for(var ii in b)
              a=a.concat(b[ii])
            range=a;
          }
          if(range.length==0){
            spawn();
            return;
          }
          let u=rnd(range);
          lastlth=u.length;
          p+=u;
        }
        if(!isalert)
          t.value=p;
        else return p;
        }catch(err){alert(err)}
      }
      const objl=@json@;
      const arr_=@list@;
    </script>
  </body>
</html>
